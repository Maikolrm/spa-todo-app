$(document).ready(()=>{let t,e=/^(?:[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/,a=$("#register-form"),s=$(".main__snackbar");function n(t,e){$(s).attr("data-status",t.status),$(s).text(t.msg),$(s).fadeIn(100,(function(){setTimeout(()=>$(this).fadeOut(100),e)}))}function r(){location.href="/404"}function i(t){$(t).prev().fadeOut(50)}function o(t){let e=$("#"+t.form),a=t.errors;if(a.length>1)a.forEach(t=>{let a=$(e).find("input[name='"+t.field+"']");$(a).addClass(t.class),$(a).prev().text(t.msg)});else{let t=a[0];if(t.snackbar)return void n(t,1e3);let s=$(e).find("input[name='"+t.field+"']");$(s).addClass(t.class),$(s).prev().text(t.msg),$(s).focus()}}if($(".register-form__close-btn").on("click",(function(){$(this).parent().fadeOut(20)})),$(".form__icon-toggle-pw").on("click",(function(){"password"===$(this).prev().prev().attr("type")?$(this).prev().prev().attr("type","text"):$(this).prev().prev().attr("type","password")})),$(".form__field").on({keyup:function(){$(this).attr("class").search("invalid")>-1&&("email"===$(this).attr("name")?e.test($(this).val().toLowerCase())&&($(this).removeClass("invalid"),i(this)):$(this).val().length>=3&&($(this).removeClass("invalid"),i(this))),$(this).attr("class").search("duplicated")>-1&&(clearInterval(t),t=setTimeout(()=>{var t;t=this,$.ajax({type:"post",url:"/validate-email",data:{email:$(t).val().replace(/\s+/g,"").trim()},dataType:"json",success:e=>{e.duplicated||($(t).removeClass("duplicated"),i(t))},error:t=>r()})},650))},focusin:function(){($(this).attr("class").search("invalid")>-1||$(this).attr("class").search("duplicated")>-1)&&$(this).prev().fadeIn(50)},focusout:function(){($(this).attr("class").search("invalid")>-1||$(this).attr("class").search("duplicated")>-1)&&i(this)}}),$(".top-section__create-account-btn").on("click",(function(){$(a).fadeIn(20),setTimeout(()=>{$(a).find("input[name='name']").focus()},30)})),$(a).on("submit",(function(t){t.preventDefault();let e={form:$(this),field:$(this).find("input"),btn:$(this).find("button")};$.ajax({type:"post",url:"/register",data:$(this).serialize(),dataType:"json",beforeSend:()=>{$(e.field).removeClass(["invalid","duplicated"]),$(e.btn).html('<i class="btn__loader"></i>'),$(e.btn).attr("disabled","true")},success:t=>function(t,e){if(t.server_broken)return void r();t.success&&(n(t,1e3),$(e.btn).html("sign up"),$(e.btn).removeAttr("disabled"),setTimeout(()=>$(e.form).fadeOut(100),1050));t.errors&&(o(t),$(e.btn).html("sign up"),$(e.btn).removeAttr("disabled"))}(t,e),error:t=>r()})})),$("#login-form").on("submit",(function(t){t.preventDefault();let e=$(this).find("button");$.ajax({type:"post",url:"/login",data:$(this).serialize(),dataType:"json",beforeSend:()=>{$(e).attr("disabled","true"),$(e).html('<i class="btn__loader"></i>')},success:t=>function(t,e){if(t.server_broken)return void r();if(t.errors)return o(t),$(e).html("sign in"),void $(e).removeAttr("disabled");t.success&&(location.href="/")}(t,e),error:t=>r()})})),$(".dashboard__content").length){function d(t){t.length?(t.map(t=>{$("#user-tasks").append(`<div id="${t._id}" class="user-tasks__task">\n\t\t\t\t\t\t\t<button data-task-action="edit" data-task-id="${t._id}" class="task__icon fas fa-cog" title="Edit"></button>\n\t\t\t\t\t\t\t<input class="task__description" value="${t.description}" readonly/>\n\t\t\t\t\t\t\t<button data-task-action="delete" data-task-id="${t._id}" class="task__icon fas fa-trash-alt" title="Delete"></button>\n\t\t\t\t\t\t</div>`)}),$(".modal__content--none-tasks").hide()):$(".modal__content--none-tasks").show(),setTimeout(()=>$(".content__modal--loading-banner").fadeOut(300),800)}$(document).find("title").html("To do - Dashboard"),$.ajax({url:"/get-tasks",dataType:"json",success:t=>d(t.tasks),error:t=>r()});let t=$(".footer__tab");function l(t,e){$.ajax({type:"post",url:"/update-task",data:t,dataType:"json",beforeSend:()=>{$(e).addClass("transparent"),$(e).attr("disabled","true"),$(e).prev().removeClass("invalid"),$(e).html('<i class="btn__loader"></i>')},success:t=>function(t,e){if(t.server_broken)return void r();if(t.success)$(e).html(""),$(e).removeClass("transparent"),$(e).removeAttr("disabled"),n(t,1e3),u($(e).prev().prev());else{let a=$("#"+t.task),s=$(a).find("input");$(e).html(""),$(e).removeClass("transparent"),$(e).removeAttr("disabled"),$(s).addClass("invalid"),$(s).focus(),n(t,1500)}t.errors&&o(t)}(t,e),error:t=>r()})}function c(t,e){$.ajax({type:"post",url:"/delete-task",data:{_id:t},dataType:"json",beforeSend:()=>{$(e).addClass("transparent"),$(e).attr("disabled","true"),$(e).html('<i class="btn__loader"></i>')},success:t=>function(t){if(t.success){let e=$("#user-tasks .user-tasks__task").length-1;$("#"+t._id).fadeOut(200,(function(){$(this).remove(),n(t,1e3),e||$(".modal__content--none-tasks").fadeIn(10)}))}else r()}(t),error:t=>r()})}function u(t){$(t).parent().parent().removeClass("edit-mode"),$(".user-tasks__task").removeClass("edit"),$(t).attr({title:"Edit","data-task-action":"edit"}),$(t).attr("class",$(t).attr("class").replace("fa-times-circle","fa-cog")),$(t).next().next().attr("class",$(t).next().next().attr("class").replace("fa-save","fa-trash-alt")),$(t).next().next().attr({title:"Delete","data-task-action":"delete"}),$(t).next().removeClass("invalid"),$(t).next().val($(t).next().val().replace(/[^a-zA-Z0-9@#\s]/g,"")),$(t).next().attr("readonly","true")}$(t).on("click",(function(){$(this).attr("class").search("selected")>-1||($(t).removeClass("selected"),$(this).addClass("selected"),$(".content__modal").fadeOut(20,()=>{setTimeout(()=>$("#"+$(this).attr("data-id")).fadeIn(20),30)}),$(this).attr("data-id").search("create-task")>-1&&setTimeout(()=>$("#create-task").find("input").focus(),50))})),$("#create-task-form").on("submit",(function(t){t.preventDefault();let e={field:$(this).find("input"),btn:$(this).find("button")};$.ajax({type:"post",url:"/create-task",data:$(this).serialize(),dataType:"json",beforeSend:()=>{$(e.btn).attr("disabled","true"),$(e.btn).html('<i class="btn__loader"></i>')},success:t=>function(t,e){if(t.server_broken)return void r();if(t.errors)return o(t),$(e.btn).html("create"),void $(e.btn).removeAttr("disabled");d(t.tasks),n(t,1e3),$(e.btn).html("create"),$(e.btn).removeAttr("disabled"),$(e.field).val(""),$(e.field).focus()}(t,e),error:t=>r()})})),$("#user-tasks").on("click",(function(t){if("BUTTON"===t.target.nodeName){let e=t.target;if("delete"===$(e).attr("data-task-action")){confirm("Delete task : "+$(e).prev().val())&&c($(e).attr("data-task-id"),e)}else"edit"===$(e).attr("data-task-action")?function(t){$(t).parent().parent().addClass("edit-mode"),$(".user-tasks__task").removeClass("edit"),$(t).parent().addClass("edit"),$(t).attr({title:"Cancel","data-task-action":"cancel"}),$(t).attr("class",$(t).attr("class").replace("fa-cog","fa-times-circle")),$(t).next().next().attr("class",$(t).next().next().attr("class").replace("fa-trash-alt","fa-save")),$(t).next().next().attr({title:"Save changes","data-task-action":"save-changes"}),$(t).next().removeAttr("readonly"),$(t).next().focus()}(e):"cancel"===$(e).attr("data-task-action")?u(e):l({_id:$(e).attr("data-task-id"),description:$(e).prev().val()},e)}}))}});